## Электронный замок двери с технологией RFID
Открывает замок двери с помощью карты, с заранее записанным UID в память устройства. Поддерживаются карты по стандарту ISO14443A/NFC-A с максимальной длиной UID 10 байт. Для внешнего управления, записи UID карт в память устройства и считывания текущего состояния замка используется интерфейс UART с физическим уровнем RS485.

### Подключение
Для питания (18В постоянного напряжения) и интерфейса RS485 используется разъем RJ45:
1. NC
2. NC
3. NC
4. NC
5. NC
6. Nc
7. NC
8. Nc

Параметры UART:
- Скорость: 115200 бод
- Количество стоп-бит: 1
- Бит паритета: нет

### Команды управления
Общение с устройством реализовано по схеме запрос-ответ. Хост направляет запрос устройству (например, считать текущий статус замка), устройство на него отвечает. Многобайтовые числа в запросе/ответе представлены в формате Little endian (первый байт младший).

Формат запроса и ответа следующий:
| Диапазон | Тип | Наименование |
| --- | --- | --- |
| [0...3] | u32 | Идентификатор протокола: 0x41525541 |
| [4...7] | u32 | Счетчик пакетов |
| [8...11] | u32 | UID источника пакета |
| [12...15] | u32 | UID адресата пакета |
| [16...31] | u32[4] | до 4 UID ретрансляторов пакета |
| [32...35] | u16 | ID запроса/ответа |
| [36...39] | u16 | Размер данных в байтах ($N$) |
| [...] | u8[N] | Данные |
| [40+N...41+N] | u16 | Контрольная сумма по стандарту CRC-16-IBM (Modbus RTU) |

Общий размер запроса/ответа равен $N+42$ байта

### Поддерживаемые запросы/ответы

| Наименование | ID | Размер данных, байт | Данные |
 --- | --- | --- | --- |
| Запрос состояния | 0x0000 | 0 | --- |
| Ответ на запрос состояния, дверь открыта | 0x0101 | n | UID, открывшей дверь, карты |
| Ответ на запрос состояния, дверь закрыта | 0x0102 | n | UID, последней открывшей дверь, карты |
| Запрос добавления карт | 0x0110 | n | Массив UIDs карт, размером n байт  $$n=\sum({UID\_size_{\ i}+1)},$$ где $UID\_size_{\ i}$ - размер $i$-го UID |
| Ответ на запрос добавить карты | 0x0111 | 2 | Количество добавленных карт |
| Запрос просмотра валидных карт | 0x0112 | 0 | --- |
| Ответ на запрос просмотра валидных карт | 0x0107 | n | Массив UIDs валидных карт, размером n байт  $$n=\sum({UID\_size_{\ i}+1)},$$ где $UID\_size_{\ i}$ - размер $i$-го UID |
| Запрос стирания валидных карт | 0x0113 | 0 | --- |
| Ответ на запрос стирания валидных карты | 0x0114 | 0 | --- |
| Запрос открытия замка | 0x0120 | 0 | --- |
| Ответ на запрос открытия замка | 0x0121 | 0 | --- |
| Запрос закрытия замка | 0x0122 | 0 | --- |
| Ответ на запрос закрытия замка | 0x0123 | 0 | --- |

Формат UID
| Диапазон | Тип | Наименование |
| --- | --- | --- |
| [0] | u8 | Размер UID в байтах |
| [1...n] | u8[n] | UID в виде массива байт |

<!-- TODO -->